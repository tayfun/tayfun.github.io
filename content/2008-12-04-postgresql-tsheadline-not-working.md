name: postgresql-tsheadline-not-working
layout: post
title: PostgreSQL ts_headline not working?
time: 2008-12-04 13:11:00 +02:00

I was trying some examples on <a href="http://www.postgresql.org/docs/8.3/interactive/textsearch-controls.html">PosgreSQL documentation</a> about highlighting search terms in a text. I would like to do full-text search on documents and have them highlighted by PostgreSQL automatically so that I could show them right away on a web page. The trouble was, the examples were not working out correctly for me. Here's the correct running:<br /><br /><code>SELECT ts_headline('english', 'The most common type of search<br />is to find all documents containing given query terms<br />and return them in order of their similarity to the<br />query.', to_tsquery('query &amp; similarity'));<br />                     ts_headline                      <br />------------------------------------------------------------<br />given &lt;b&gt;query&lt;/b&gt; terms<br />and return them in order of their &lt;b&gt;similarity&lt;/b&gt; to the<br />&lt;b&gt;query&lt;/b&gt;.<br /></code><br /><br />But here's what I was getting:<br /><br /><code>SELECT ts_headline('english', 'The most common type of search is to find all documents containing given query terms and return them in order of their similarity to the  query.', to_tsquery('query & similarity'));<br />                                     ts_headline                                      <br />--------------------------------------------------------------------------------------<br /> The most common type of search is to find all documents containing given query terms<br />(1 row)<br /></code><br /><br />After googling it for some time I found the reason. It is because of the default search configuration I was using. Since it is not "english", the to_tsquery function does not work as expected.<br /><br /><code>=> show default_text_search_config;<br /> default_text_search_config <br />----------------------------<br /> pg_catalog.turkish<br />(1 row)<br /><br />=> select to_tsquery('query & similarity');<br />       to_tsquery       <br />------------------------<br /> 'query' & 'similarity'<br />(1 row)<br /><br />=> select to_tsquery('english', 'query & similarity');<br />     to_tsquery      <br />---------------------<br /> 'queri' & 'similar'<br />(1 row)<br /></code><br /><br />Aha. Now we can retry:<br /><br /><code>SELECT ts_headline('english', 'The most common type of search is to find all documents containing given query terms and return them in order of their similarity to the  query.', to_tsquery('english', 'query & similarity'));<br />                                            ts_headline                                             <br />----------------------------------------------------------------------------------------------------<br />given &lt;b&gt;query&lt;/b&gt; terms<br />and return them in order of their &lt;b&gt;similarity&lt;/b&gt; to the<br />&lt;b&gt;query&lt;/b&gt;.<br />(1 row)<br /></code><br /><br />Now that's better.
