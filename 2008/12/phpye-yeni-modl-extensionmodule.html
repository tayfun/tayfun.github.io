<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="content-language" content="tr">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHP'ye yeni modül (extension/module) derlemek | Tayfun Sen</title>
<link rel="icon" type="image/png" href="/favicon.png" />
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Ubuntu:700&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" media="screen" />
<link rel="stylesheet" href="/css/main.css?cache=20150102-01" media="screen" />
<link href="http://blog.tayfunsen.com/feeds/posts/default" rel="alternate" title="Atom" type="application/atom+xml" />
</head>
<body class="homepage" >
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '482957368512369',
      xfbml      : true,
      version    : 'v2.2'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div class="container">
  <header class="mainheader">
    <a href="/"><img class="logo img-circle" src="/images/initials.png"></a>
  </header>
  <div id="content">
<article>
    <div class="postheader">
        <div class="posttitle">
            PHP'ye yeni modül (extension/module) derlemek
        </div>
        <div class="postmetadata">
            <span>Written <time class="postdate" datetime="2008-12-29 00:00:00+01:00" pubdate title="on Mon 29 December 2008">on Mon 29 December 2008</time>.</span>
        </div>
    </div>
    <div class="postcontent">
        <p>Şu aralar symfony'ye çalışıyorum. Symfony bir web geliştirme framework'ü yani size çeşitli kütüphaneler, programlar sunarak web projelerinize kolaylıklar sağlıyor. Symfony anasayfasında 24 saatlik bir demo proje var, ismi <a href="http://www.symfony-project.org/jobeet/1_2/Propel/en/">Jobeet</a>. Bununla uğraşırken şöyle bir problemle karşılaştım:<br /><br /><code>$ symfony propel-build-model<br />&gt;&gt; schema    converting "~/jobeet/config/schema.yml" to XML<br />&gt;&gt; schema    putting ~/jobeet/config/generated-schema.xml<br />&gt;&gt; propel    Running "om" phing task<br />[propel-om] Could not perform XLST transformation.  Make sure PHP has been compiled/configured to support XSLT.<br />&gt;&gt; file-     ~/jobeet/config/generated-schema.xml<br />&gt;&gt; autoload  reloading autoloading<br /></code><br /><br />PHP için bir eklentinin yokluğundan yakınıyor. "php -m" ile var olan modüllere baktığımda xsl modülünü bulamadım. İnternette biraz araştırdığımda PHP sayfasında modülün <a href="http://www.php.net/manual/en/xslt.installation.php">PHP ilk kurulurken nasıl derleme seçenekleri arasına alınabileceği</a> yazıyordu. Tüm PHP'yi tekrar derlemek istemedim doğal olarak ve daha hızlı bir yol buldum. Bu teknik, tüm PHP modülleri için uygulanabilir.<br /><br />Öncelikle apt-get kullanarak php-dev paketini kurmamız gerekli:<br /><br /><code># apt-get install php5-dev </code><br /><br />Bundan sonra bir yerlerden php kaynak kodunu indirmeliyiz. Ben Fransa'daki bir yansıyı kullandım:<br /><br /><code> $ wget http://tr.php.net/get/php-5.2.8.tar.bz2/from/fr.php.net/mirror </code><br /><br />PHP kaynak kodlarını indirirken dikkat etmemiz gereken noktalardan birisi kendi PHP sürümümüze yakın bir kaynak paketini indirmek olmalı. Örneğin benim sürümüm 5.2.6, 5.2 dalından bir sürüm işimi görür. Daha eski bir sürümü indirmenizi (örneğin 5.1 dalından) veya çok daha yeni bir sürümü (çıkacak olan 5.3 dalı gibi) önermiyorum. Yoksa uyumluluk sorunları yaşayabilirsiniz.<br /><br />İndirme bittikten sonra paketi açın:<br /><br /><code>$ bunzip2 php-5.2.8.tar.bz2 </code><br /><br />ve<br /><br /><code>$ tar xvf php-5.2.8.tar </code><br /><br />Bundan sonra PHP kaynak kodları içinde istediğimiz modüle girip derleyeceğiz. Benim için bu xsl modülü:<br /><br /><code>$ cd php-5.2.8/ext/xsl/ <br />$ phpize<br />$ ./configure<br />$ make<br /></code><br />Evet artık modülümüz derlendi. Yazılan son satırlar belki şuna benziyordur:<br /><br /><code>Libraries have been installed in:<br />   /ambar1/progz/php-5.2.8/ext/xsl/modules<br /><br />If you ever happen to want to link against installed libraries<br />in a given directory, LIBDIR, you must either use libtool, and<br />specify the full pathname of the library, or use the <code>-LLIBDIR'&lt;br /&gt;flag during linking and do at least one of the following:&lt;br /&gt;   - add LIBDIR to the</code>LD_LIBRARY_PATH' environment variable<br />     during execution<br />   - add LIBDIR to the <code>LD_RUN_PATH' environment variable&lt;br /&gt;     during linking&lt;br /&gt;   - use the</code>-Wl,--rpath -Wl,LIBDIR' linker flag<br />   - have your system administrator add LIBDIR to `/etc/ld.so.conf'<br /><br />See any operating system documentation about shared libraries for<br />more information, such as the ld(1) and ld.so(8) manual pages.<br />----------------------------------------------------------------------<br /><br />Build complete.<br />Don't forget to run 'make test'.<br /></code><br />Bu açıklamadan da anlaşılacağı gibi derlenmiş kütüphanelerimiz modules/ dizininde.<br /><br /><code>$ ls modules/<br />xsl.la  xsl.so<br /></code><br />Bundan sonra yapmamız gerekenler bu modülü düzgün bir yerlere kopyalayıp php.ini dosyasını değiştirmek (burada root olmanız gerekiyor):<br /><br /><code># cp modules/xsl.so /usr/lib/php5/20060613+lfs/ <br /></code><br />php.ini dosyasında önce modül dizinini tanımlıyoruz:<br /><code><br />extension_dir = "/usr/lib/php5/20060613+lfs/"<br /></code><br />Sonra da bu modülün yüklenmesini:<br /><code><br />extension=xsl.so<br /></code><br /><br />Bu kadar, herşey bitti. Eğer bir web sunucusu üzerinden PHP'yi ve bu modülü kullanıyorsanız tekrar başlatmanız gerekecek. Benim için bu sunucu apache:<br /><code><br /># apache2ctl restart<br /></code><br />Bilmeniz gereken bir nokta php.ini dosyasıyla ilgili. PHP için iki farklı php.ini dosyası olabiliyor. Bunlardan biri komut satırından çalıştırılan php interpreter için, diğeri ise apache tarafından kullanılan php çeviricisi için varlar. Yani eğer komut satırından php kullanacaksanız, mesela belirli betikler yazmışsanız "cli" (command line interpreter) ayar dosyasını değiştirmeniz gerekiyor. Bendeki ayar dosyaları şöyle:<br /><code><br /># locate php.ini<br />/etc/php4/apache2/php.ini<br />/etc/php5/apache2/php.ini<br />/etc/php5/cli/php.ini<br />/usr/share/doc/php5-common/examples/php.ini-dist<br />/usr/share/doc/php5-common/examples/php.ini-paranoid<br />/usr/share/doc/php5-common/examples/php.ini-recommended<br />/usr/share/php5/php.ini-dist<br />/usr/share/php5/php.ini-dist.cli<br /></code><br /><br />İlk iki dosya apache için (php4 ve php5 için ayrı ayrı) ve 3. ayar dosyası da komut satırından çalıştırılan PHP için. Tabii Debian kullanmıyorsanız (sahi neden Debian kullanmıyorsunuz :)) dosyalarınızın yerleri de farklı olacaktır.<br /><br />Kolay gelsin.<br /><br /><br />[ thanks to Mattias Geniar for <a href="http://mattiasgeniar.be/php/how-to-compile-and-install-php-extensions-from-source/">the great article</a>. ]</p>
    </div>
    <div class="postfooter">
        <div class="fb-like" data-share="false" data-width="450" data-show-faces="false" data-layout="button"></div>
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="tayfunsen" data-related="tayfunsen" data-dnt="true">Tweet</a>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'tayfunsen';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</article>
  </div><!-- content -->
  <div class="footer">
    &copy; <span id="footername">Tayfun Şen</span> 2015. No <span style="background-color:#ccc; padding: 0 3px"><span style="color:red">p</span><span style="color:green">i</span><span style="color:rgb(8, 8, 161)">x</span><span style="color:rgb(143, 6, 5)">e</span><span style="color:black">l</span><span style="color:#2FA5A7">s</span></span> were harmed in during the making of this website. Powered by <a href="https://github.com/getpelican/pelican">Pelican</a>.
  </div><!-- footer -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="/js/main.js"></script>
<script>
var sc_project=2353622;
var sc_invisible=1;
var sc_security="6d6208aa";
</script>
<script src="http://www.statcounter.com/counter/counter.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div><!-- wrapper -->
</body>
</html>