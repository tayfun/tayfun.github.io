<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="content-language" content="tr">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>acts_as_state_machine | Tayfun Sen</title>
<link rel="icon" type="image/png" href="/favicon.png" />
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Ubuntu:700&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" media="screen" />
<link rel="stylesheet" href="/css/main.css?cache=20150102-01" media="screen" />
<link href="http://blog.tayfunsen.com/feeds/posts/default" rel="alternate" title="Atom" type="application/atom+xml" />
</head>
<body class="homepage" >
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '482957368512369',
      xfbml      : true,
      version    : 'v2.2'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div class="container">
  <header class="mainheader">
    <a href="/"><img class="logo img-circle" src="/images/initials.png"></a>
  </header>
  <div id="content">
<article>
    <div class="postheader">
        <div class="posttitle">
            acts_as_state_machine
        </div>
        <div class="postmetadata">
            <span>Written <time class="postdate" datetime="2008-03-11 00:00:00+01:00" pubdate title="on Tue 11 March 2008">on Tue 11 March 2008</time></span>
        </div>
    </div>
    <div class="postcontent">
        <p>I have recently begun using several Rails plugins after having coded many things by hand. I think its better when you code everything by hand in the beginning but after some time it will be inevitable that you use others' plugins. Anyway, one plugin that I have reasonably struggled to understand is acts_as_state_machine plugin. What it does is, it provides your models with a state. That is, they become stateful. The state itself is of course stored in the database table with column called 'state'. The plugin provides you with simple methods for setting transitions and querying states. Although very useful, it has some quirks of its own.<br /><br />One thing is that when you create a new object with <span style="font-weight: bold;">Class.new</span>, you do not get state property immediately. It's only after you save the object that the state is set. So you can use <span style="font-weight: bold;">'create'</span> method to create and save the object with its state property. Another solution to this problem is setting the default <span style="font-weight: bold;">'state'</span> through migration files. But this has other problems of its own. When you set <span style="font-weight: bold;">state</span> through migrations or simply through <span style="font-weight: bold;">object.state = 'some_state'</span> then you will lose this state data when it is saved to the database. The <span style="font-weight: bold;">'state'</span> property when the object is saved to the database is then set to the initial state defined in the model. Here are some examples for clarity, build on the code from <a href="http://rails.aizatto.com/2007/05/24/ruby-on-rails-finite-state-machine-plugin-acts_as_state_machine/">Aizat's blog (excellent read by the way)</a>:<br /><pre><code><br />class Person &lt; initial =""&gt; :sleeping<br />state :sleeping<br />state :showering<br />state :working<br />state :dating<br /><br />event :shower do<br /> transitions :from =&gt; :sleeping, :to =&gt; :showering<br /> transitions :from =&gt; :working, :to =&gt; :showering<br /> transitions :from =&gt; :dating, :to =&gt; :showering<br />end<br /><br />event :work do<br /> transitions :from =&gt; :showering, :to =&gt; :working<br /> # Going to work before showering?  Stinky.<br /> transitions :from =&gt; :sleeping, :to =&gt; :working<br />end<br /><br />event :date do<br /> transitions :from =&gt; :showering, :to =&gt; :dating<br />end<br /><br />event :sleep do<br /> transitions :from =&gt; :showering, :to =&gt; :sleeping<br /> transitions :from =&gt; :working, :to =&gt; :sleeping<br /> transitions :from =&gt; :dating, :to =&gt; :sleeping<br />end<br />end<br /><br />&gt;&gt; person = Person.new<br />=&gt; #&lt;Person id: nil, state: nil, created_at: nil, updated_at: nil&gt;<br />&gt;&gt; person.shower!<br />NoMethodError: You have a nil object when you didn't expect it!</code></pre><br /><span style="font-weight: bold;">But, here's something interesting:</span><br /><code><br />&gt;&gt; person.state = 'working'<br />=&gt; "working"<br />&gt;&gt; person<br />=&gt; #&lt;Person id: nil, state: "working", created_at: nil, updated_at: nil&gt;<br />&gt;&gt; person.shower!<br />=&gt; true<br />&gt;&gt; person<br />=&gt; #&lt;Person id: 3, state: "sleeping", created_at: "2008-03-11 15:04:41", updated_at: "2008-03-11 15:04:41"&gt;<br /></code><br />It's still sleeping in the end! What I understand is that it doesn't matter what you do until the record is saved. It will still be initialized like it is defined no matter what events you call before.<br />You have to understand how callbacks are called to understand this example.<br /><br />Have a nice day.</p>
    </div>
    <div class="postfooter">
        <div class="fb-like" data-share="false" data-width="450" data-show-faces="false" data-layout="button"></div>
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="tayfunsen" data-related="tayfunsen" data-dnt="true">Tweet</a>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'tayfunsen';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</article>
  </div><!-- content -->
  <div class="footer">
    &copy; <span id="footername">Tayfun Åžen</span> 2015. No <span style="background-color:#ccc; padding: 0 3px"><span style="color:red">p</span><span style="color:green">i</span><span style="color:rgb(8, 8, 161)">x</span><span style="color:rgb(143, 6, 5)">e</span><span style="color:black">l</span><span style="color:#2FA5A7">s</span></span> were harmed in during the making of this website. Powered by <a href="https://github.com/getpelican/pelican">Pelican</a>.
  </div><!-- footer -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="/js/main.js"></script>
<script>
var sc_project=2353622;
var sc_invisible=1;
var sc_security="6d6208aa";
</script>
<script src="http://www.statcounter.com/counter/counter.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div><!-- wrapper -->
</body>
</html>